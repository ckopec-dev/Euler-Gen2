# Euler Problem 329 Solution in LMC

I'll solve Euler Problem 329, which asks for the probability that a randomly chosen path through a 1000-digit number produces a specific sequence of prime and composite digits.

## Problem Understanding

The problem involves:
- A 1000-digit number where each digit is either prime (2,3,5,7) or composite (1,4,6,8,9)
- A path of 10 digits that starts at a random position
- We need to find the probability that this path spells out a specific sequence of prime/composite patterns

Let me write the LMC solution:

```assembly
        ORG 100
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0

; Main program
        LDA ONE
        STA COUNT
        LDA ONE
        STA SUM
        LDA ONE
        STA PROB
        LDA ONE
        STA DENOM
        LDA ONE
        STA NUMER

; Initialize digit array (1000 digits)
        LDA DIGIT1
        STA DIGITS
        LDA DIGIT2
        STA DIGITS+1
        LDA DIGIT3
        STA DIGITS+2
        LDA DIGIT4
        STA DIGITS+3
        LDA DIGIT5
        STA DIGITS+4
        LDA DIGIT6
        STA DIGITS+5
        LDA DIGIT7
        STA DIGITS+6
        LDA DIGIT8
        STA DIGITS+7
        LDA DIGIT9
        STA DIGITS+8
        LDA DIGIT10
        STA DIGITS+9

; Process all possible starting positions
        LDA COUNT
        STA POS
        LDA ONE
        STA TEMP
        LDA POS
        SUB TEMP
        BRZ LOOP_END

; Calculate probability for current position
        LDA POS
        LDA DIGITS
        STA DIGIT_VAL
        LDA DIGIT_VAL
        LDA PRIME_CHECK
        STA PRIME_FLAG
        LDA PRIME_FLAG
        BRZ NOT_PRIME
        LDA PROB
        MUL TWO
        STA PROB
        BRZ PROB_LOOP
NOT_PRIME LDA PROB
        MUL THREE
        STA PROB
        BRZ PROB_LOOP

PROB_LOOP LDA POS
        ADD ONE
        STA POS
        LDA POS
        SUB ONE
        BRZ LOOP_END
        BRA PROB_LOOP

LOOP_END LDA SUM
        ADD PROB
        STA SUM
        LDA DENOM
        ADD ONE
        STA DENOM
        LDA SUM
        LDA DENOM
        DIV TWO
        STA RESULT

        LDA RESULT
        HLT

; Helper constants
ONE     DAT 1
TWO     DAT 2
THREE   DAT 3
ZERO    DAT 0

; Digit array - this would contain the actual 1000 digits
DIGITS  DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0

; Prime checking routine
PRIME_CHECK LDA DIGIT_VAL
        LDA TWO
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA THREE
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA FIVE
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA SEVEN
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA ZERO
        STA PRIME_FLAG
        BRZ END_PRIME
IS_PRIME LDA ONE
        STA PRIME_FLAG
END_PRIME LDA PRIME_FLAG
        HLT

; Constants for prime digits
TWO     DAT 2
THREE   DAT 3
FIVE    DAT 5
SEVEN   DAT 7

; Data section for the 1000-digit number
; This would contain the actual digits of the number
DIGIT1  DAT 3
DIGIT2  DAT 1
DIGIT3  DAT 4
DIGIT4  DAT 1
DIGIT5  DAT 5
DIGIT6  DAT 9
DIGIT7  DAT 2
DIGIT8  DAT 6
DIGIT9  DAT 5
DIGIT10 DAT 3
DIGIT11 DAT 5
DIGIT12 DAT 8
DIGIT13 DAT 9
DIGIT14 DAT 7
DIGIT15 DAT 9
; ... continue for all 1000 digits

        END
```

Wait, let me reconsider this more carefully. The actual Euler 329 problem requires a much more precise approach:

```assembly
        ORG 100
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0

; Main program - calculate probability for prime/composite sequence
MAIN    LDA COUNT
        STA POS
        LDA ONE
        STA SUM
        LDA ONE
        STA PROB
        LDA ONE
        STA DENOM
        LDA ONE
        STA NUMER

; Loop through all possible starting positions (1 to 1000)
        LDA POS
        LDA ONE
        SUB POS
        BRZ END_LOOP

; Calculate probability for current digit
        LDA POS
        LDA DIGITS
        STA DIGIT_VAL
        LDA DIGIT_VAL
        LDA PRIME_CHECK
        STA IS_PRIME
        LDA IS_PRIME
        BRZ NOT_PRIME

; If prime, multiply probability by 1/4 (since 4 primes out of 10 digits)
        LDA PROB
        MUL ONE
        STA PROB
        LDA PROB
        DIV FOUR
        STA PROB
        BRA NEXT_POS

NOT_PRIME
; If composite, multiply probability by 1/5 (since 5 composites out of 10 digits)
        LDA PROB
        MUL ONE
        STA PROB
        LDA PROB
        DIV FIVE
        STA PROB

NEXT_POS LDA POS
        ADD ONE
        STA POS
        BRA MAIN

END_LOOP LDA SUM
        ADD PROB
        STA SUM
        LDA DENOM
        ADD ONE
        STA DENOM
        LDA SUM
        LDA DENOM
        DIV TWO
        STA RESULT

        LDA RESULT
        HLT

; Constants
ONE     DAT 1
TWO     DAT 2
THREE   DAT 3
FOUR    DAT 4
FIVE    DAT 5
ZERO    DAT 0

; Digit array (simplified for demonstration)
DIGITS  DAT 3
        DAT 1
        DAT 4
        DAT 1
        DAT 5
        DAT 9
        DAT 2
        DAT 6
        DAT 5
        DAT 3
        DAT 5
        DAT 8
        DAT 9
        DAT 7
        DAT 9
        DAT 3
        DAT 2
        DAT 3
        DAT 8
        DAT 4
        DAT 6

; Prime checking function
PRIME_CHECK LDA DIGIT_VAL
        LDA TWO
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA THREE
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA FIVE
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA SEVEN
        SUB DIGIT_VAL
        BRZ IS_PRIME
        LDA ZERO
        STA IS_PRIME
        BRZ END_CHECK
IS_PRIME LDA ONE
        STA IS_PRIME
END_CHECK LDA IS_PRIME
        HLT

; Prime digit constants
TWO     DAT 2
THREE   DAT 3
FIVE    DAT 5
SEVEN   DAT 7

; Result storage
RESULT  DAT 0

        END
```

Actually, let me provide a cleaner, more correct approach:

```assembly
        ORG 100
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0

; Euler Problem 329 Solution
; Calculate probability of prime/composite sequence in 1000-digit number

START   LDA ONE
        STA POSITION
        LDA ZERO
        STA TOTAL_PROB
        LDA ONE
        STA DENOMINATOR

LOOP    LDA POSITION
        LDA MAX_POSITION
        SUB POSITION
        BRZ END_CALC

; Get digit at current position
        LDA POSITION
        LDA DIGIT_ARRAY
        STA CURRENT_DIGIT

; Check if prime
        LDA CURRENT_DIGIT
        LDA PRIME_CHECK
        STA IS_PRIME

; Calculate contribution to probability
        LDA TOTAL_PROB
        LDA IS_PRIME
        BRZ NOT_PRIME
        ; Prime case - multiply by 1/4
        MUL ONE
        DIV FOUR
        BRA PROB_UPDATE
NOT_PRIME
        ; Composite case - multiply by 1/5
        MUL ONE
        DIV FIVE
PROB_UPDATE
        STA TOTAL_PROB

        LDA POSITION
        ADD ONE
        STA POSITION
        BRA LOOP

END_CALC LDA TOTAL_PROB
        LDA DENOMINATOR
        DIV TWO
        STA RESULT

        LDA RESULT
        HLT

; Constants
ONE     DAT 1
TWO     DAT 2
THREE   DAT 3
FOUR    DAT 4
FIVE    DAT 5
ZERO    DAT 0
MAX_POSITION DAT 1000

; Digit array (1000 digits)
DIGIT_ARRAY DAT 3
        DAT 1
        DAT 4
        DAT 1
        DAT 5
        DAT 9
        DAT 2
        DAT 6
        DAT 5
        DAT 3
        DAT 5
        DAT 8
        DAT 9
        DAT 7
        DAT 9
        DAT 3
        DAT 2
        DAT 3
        DAT 8
        DAT 4
        DAT 6

; Prime checking routine
PRIME_CHECK LDA CURRENT_DIGIT
        LDA TWO
        SUB CURRENT_DIGIT
        BRZ IS_PRIME
        LDA THREE
        SUB CURRENT_DIGIT
        BRZ IS_PRIME
        LDA FIVE
        SUB CURRENT_DIGIT
        BRZ IS_PRIME
        LDA SEVEN
        SUB CURRENT_DIGIT
        BRZ IS_PRIME
        LDA ZERO
        STA IS_PRIME
        BRZ END_PRIME
IS_PRIME LDA ONE
        STA IS_PRIME
END_PRIME LDA IS_PRIME
        HLT

RESULT  DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0
        DAT 0

        END
```

This is a conceptual solution. The actual Euler 329 problem requires a much more complex mathematical approach involving Markov chains and careful probability calculations. The LMC implementation would need to be significantly more complex to handle the full mathematical requirements of the problem.

